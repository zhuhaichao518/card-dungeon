<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>⚔️ Card Dungeon</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ───── 头部 ───── -->
  <header id="header">
    <a href="index.html" class="header-back">◀ 菜单</a>
    <h1>⚔️ CARD DUNGEON</h1>
    <div class="hp-bar-container">
      <label>HP</label>
      <div class="hp-bar"><div class="hp-bar-fill" id="hp-bar-fill"></div></div>
      <span class="hp-text" id="hp-text">70 / 70</span>
    </div>
    <span id="floor-label">第 1 / 20 层</span>
    <button id="btn-pause" class="btn-icon" title="暂停 (Esc)">⏸</button>
  </header>

  <!-- ═══ 主体 ═══ -->
  <div id="game-container">

    <!-- ▶ 探索界面 -->
    <div id="explore-screen">
      <div id="map-area">
        <canvas id="map-canvas"></canvas>
      </div>
      <aside id="side-panel">
        <div class="panel-section">
          <h3>📦 背包</h3>
          <div class="inventory-item"><span style="color:#ffd700">⚷</span> 黄钥匙 <span class="key-count" id="key-yellow-count">0</span></div>
          <div class="inventory-item"><span style="color:#4fc3f7">⚷</span> 蓝钥匙 <span class="key-count" id="key-blue-count">0</span></div>
          <div class="inventory-item"><span style="color:#ef5350">⚷</span> 红钥匙 <span class="key-count" id="key-red-count">0</span></div>
        </div>
        <div class="panel-section">
          <h3>📜 日志</h3>
          <div id="message-log"></div>
        </div>
        <div class="panel-section">
          <h3>🎮 操作</h3>
          <div class="tips">
            <div>WASD / 方向键 移动</div>
            <div>点击任意可达格子自动寻路</div>
            <div>Esc / ⏸ 暂停存档</div>
          </div>
          <button id="btn-deck-view" class="btn-deck-view">📖 查看卡组</button>
        </div>
      </aside>
    </div>

    <!-- ▶ 战斗界面（怪物上方，英雄下方）-->
    <div id="battle-screen" class="hidden">

      <!-- ① 怪物区 -->
      <div class="combatant-card enemy-card">
        <div class="combatant-header">
          <canvas id="battle-monster-sprite" width="32" height="32" style="image-rendering:pixelated;width:48px;height:48px;border-radius:6px;background:#111;"></canvas>
          <span class="combatant-name" id="battle-monster-name">怪物</span>
          <span class="combatant-shield-badge">🛡 <span id="battle-monster-shield">0</span></span>
        </div>
        <div class="combatant-hp">
          <div class="hp-bar flex1"><div class="hp-bar-fill enemy-hp" id="battle-monster-hp-bar" style="width:100%"></div></div>
          <span class="hp-text" id="battle-monster-hp-text">30 / 30</span>
        </div>
        <div class="ap-row">
          <span class="ap-label">⚡ 行动值</span>
          <div id="monster-ap-display" class="ap-gems"></div>
        </div>
        <div id="battle-monster-effects" class="effects-row"></div>
        <!-- 怪物意图 -->
        <div class="monster-intent-section">
          <div id="battle-monster-intent" class="monster-intent-cards"></div>
        </div>
      </div>

      <!-- ② 中间操作行 -->
      <div class="battle-action-row">
        <span id="battle-turn-label" class="turn-label">⚔️ 回合 1</span>
        <button id="end-turn-btn">结束回合 →</button>
      </div>

      <!-- ③ 英雄区 -->
      <div class="combatant-card hero-card">
        <div class="combatant-header">
          <span class="combatant-name">🧙 英雄</span>
          <span class="combatant-shield-badge">🛡 <span id="battle-hero-shield">0</span></span>
        </div>
        <div class="combatant-hp">
          <div class="hp-bar flex1"><div class="hp-bar-fill hero-hp" id="battle-hero-hp-bar" style="width:100%"></div></div>
          <span class="hp-text" id="battle-hero-hp-text">70 / 70</span>
        </div>
        <div class="ap-row">
          <span class="ap-label">⚡ 行动值</span>
          <div id="ap-display" class="ap-gems"></div>
          <span id="ap-text" class="ap-num">0/0</span>
        </div>
        <div id="battle-hero-effects" class="effects-row"></div>
      </div>

      <!-- ④ 手牌 -->
      <div class="battle-hand-area">
        <div class="hand-label">手牌</div>
        <div id="battle-hand"></div>
      </div>

      <!-- ⑤ 战斗日志 -->
      <div id="battle-log"></div>

    </div><!-- /battle-screen -->

  </div><!-- /game-container -->

  <!-- ═══ 剧情对话框 ═══ -->
  <div id="story-overlay" class="hidden">
    <div id="story-box">
      <div id="story-header">
        <span id="story-portrait" class="story-portrait">📜</span>
        <span id="story-speaker" class="story-speaker"></span>
      </div>
      <div id="story-text" class="story-text"></div>
      <button id="story-next-btn" class="story-next-btn">▶ 继续</button>
    </div>
  </div>

  <!-- ═══ 剧情战斗结果 ═══ -->
  <div id="story-result-panel" class="hidden">
    <div id="story-result-box">
      <div id="story-result-text"></div>
      <button id="story-result-btn">继续...</button>
    </div>
  </div>

  <!-- ═══ 意图卡 Tooltip（全局） ═══ -->
  <div id="intent-tooltip" class="intent-tooltip hidden">
    <div id="intent-tooltip-name" class="tt-name"></div>
    <div id="intent-tooltip-desc" class="tt-desc"></div>
    <div id="intent-tooltip-cost" class="tt-cost"></div>
  </div>

  <!-- ═══ 暂停菜单 ═══ -->
  <div id="pause-menu" class="hidden">
    <div id="pause-box">
      <button class="pause-close-btn" id="pause-close">✕</button>
      <h2>⏸ 暂停</h2>
      <div class="pause-section">
        <h3>💾 保存存档</h3>
        <div class="pause-slots">
          <div class="pause-save-slot" data-slot="0"><span class="slot-label">存档 1</span><span class="slot-info">（空）</span></div>
          <div class="pause-save-slot" data-slot="1"><span class="slot-label">存档 2</span><span class="slot-info">（空）</span></div>
          <div class="pause-save-slot" data-slot="2"><span class="slot-label">存档 3</span><span class="slot-info">（空）</span></div>
        </div>
      </div>
      <div class="pause-actions">
        <button class="pause-btn" id="pause-resume">▶ 继续游戏</button>
        <button class="pause-btn danger" id="pause-back-menu">🏠 返回主菜单</button>
      </div>
    </div>
  </div>

  <!-- ═══ 查看卡组弹窗 ═══ -->
  <div id="deck-view-panel" class="hidden">
    <div id="deck-view-box">
      <div id="deck-view-header">
        <span>📖 我的卡组</span>
        <span id="deck-view-count" class="deck-view-count"></span>
        <button id="deck-view-close" class="deck-view-close">✕</button>
      </div>
      <div id="deck-view-grid"></div>
    </div>
  </div>

  <!-- ═══ 通用弹窗 ═══ -->
  <div id="overlay" class="hidden">
    <div id="overlay-box">
      <div id="overlay-title"></div>
      <div id="overlay-msg"></div>
      <button id="overlay-btn"></button>
    </div>
  </div>

  <!-- ═══ Toast ═══ -->
  <div id="toast" class="hidden"></div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
